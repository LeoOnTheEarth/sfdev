@ECHO OFF

SETLOCAL ENABLEDELAYEDEXPANSION

  SET ARGV=
  SET DEBUG=0
  FOR %%A IN (%*) DO (
    CALL :GET_DRIVE %%A ARGUMENT

    IF EXIST %%A (
      SET FILEPATH=!ARGUMENT:~0,5!
      IF NOT !FILEPATH! == /mnt/ (
        CALL :GET_DRIVE %CD%\%%A ARGUMENT
      )
    )

    IF !ARGUMENT!==--wsl-debug (
      SET DEBUG=1
    ) ELSE (
      FOR /f "tokens=2" %%a IN ("!ARGUMENT!") DO SET ARGUMENT=\"!ARGUMENT!\"

      SET ARGV=!ARGV! !ARGUMENT!
    )
  )

  IF !DEBUG!==1 (
    ECHO "%USERPROFILE%\AppData\Local\Microsoft\WindowsApps\ubuntu1804.exe" run "!ARGV!"
    ECHO.
  )

  "%USERPROFILE%\AppData\Local\Microsoft\WindowsApps\ubuntu1804.exe" run "!ARGV!"

  IF !DEBUG!==1 (
    ECHO.
    PAUSE
  )

ENDLOCAL

EXIT /B %ERRORLEVEL%

:GET_DRIVE
SETLOCAL ENABLEDELAYEDEXPANSION
  SET ARGUMENT=%~1
  SET DRIVE=%ARGUMENT:~0,2%
  SET WSL_DRIVE=

  IF %DRIVE%==A: SET WSL_DRIVE=a
  IF %DRIVE%==B: SET WSL_DRIVE=b
  IF %DRIVE%==C: SET WSL_DRIVE=c
  IF %DRIVE%==D: SET WSL_DRIVE=d
  IF %DRIVE%==E: SET WSL_DRIVE=e
  IF %DRIVE%==F: SET WSL_DRIVE=f
  IF %DRIVE%==G: SET WSL_DRIVE=g
  IF %DRIVE%==H: SET WSL_DRIVE=h
  IF %DRIVE%==I: SET WSL_DRIVE=i
  IF %DRIVE%==J: SET WSL_DRIVE=j
  IF %DRIVE%==K: SET WSL_DRIVE=k
  IF %DRIVE%==L: SET WSL_DRIVE=l
  IF %DRIVE%==M: SET WSL_DRIVE=m
  IF %DRIVE%==N: SET WSL_DRIVE=n
  IF %DRIVE%==O: SET WSL_DRIVE=o
  IF %DRIVE%==P: SET WSL_DRIVE=p
  IF %DRIVE%==Q: SET WSL_DRIVE=q
  IF %DRIVE%==R: SET WSL_DRIVE=r
  IF %DRIVE%==S: SET WSL_DRIVE=s
  IF %DRIVE%==T: SET WSL_DRIVE=t
  IF %DRIVE%==U: SET WSL_DRIVE=u
  IF %DRIVE%==V: SET WSL_DRIVE=v
  IF %DRIVE%==W: SET WSL_DRIVE=w
  IF %DRIVE%==X: SET WSL_DRIVE=x
  IF %DRIVE%==Y: SET WSL_DRIVE=y
  IF %DRIVE%==Z: SET WSL_DRIVE=z

  IF %DRIVE%==a: SET WSL_DRIVE=a
  IF %DRIVE%==b: SET WSL_DRIVE=b
  IF %DRIVE%==c: SET WSL_DRIVE=c
  IF %DRIVE%==d: SET WSL_DRIVE=d
  IF %DRIVE%==e: SET WSL_DRIVE=e
  IF %DRIVE%==f: SET WSL_DRIVE=f
  IF %DRIVE%==g: SET WSL_DRIVE=g
  IF %DRIVE%==h: SET WSL_DRIVE=h
  IF %DRIVE%==i: SET WSL_DRIVE=i
  IF %DRIVE%==j: SET WSL_DRIVE=j
  IF %DRIVE%==k: SET WSL_DRIVE=k
  IF %DRIVE%==l: SET WSL_DRIVE=l
  IF %DRIVE%==m: SET WSL_DRIVE=m
  IF %DRIVE%==n: SET WSL_DRIVE=n
  IF %DRIVE%==o: SET WSL_DRIVE=o
  IF %DRIVE%==p: SET WSL_DRIVE=p
  IF %DRIVE%==q: SET WSL_DRIVE=q
  IF %DRIVE%==r: SET WSL_DRIVE=r
  IF %DRIVE%==s: SET WSL_DRIVE=s
  IF %DRIVE%==t: SET WSL_DRIVE=t
  IF %DRIVE%==u: SET WSL_DRIVE=u
  IF %DRIVE%==v: SET WSL_DRIVE=v
  IF %DRIVE%==w: SET WSL_DRIVE=w
  IF %DRIVE%==x: SET WSL_DRIVE=x
  IF %DRIVE%==y: SET WSL_DRIVE=y
  IF %DRIVE%==z: SET WSL_DRIVE=z

  IF NOT "!WSL_DRIVE!"=="" (
    SET ARGUMENT=!ARGUMENT:~2!
    SET ARGUMENT=!ARGUMENT:\=/!
    SET ARGUMENT=/mnt/!WSL_DRIVE!!ARGUMENT!
  )

ENDLOCAL & SET %~2=%ARGUMENT%

GOTO:EOF
